<div class="todo">
  <div class="mapa">
    <div
      class="loseta"
      *ngFor="let mapa of datoservice.mapaActual"
      [ngStyle]="
        mapa.visible
          ? { 'background-color': mapa.carretera ? 'grey' : 'orange' }
          : { 'background-color': ' rgba(0, 0, 0, 0)' }
      "
    >
      <button
        class="puertaSup"
        [ngStyle]="
          mapa.puertaSup ? { 'background-color': 'rgb(59, 22, 5)' } : {}
        "
        (click)="puerta(mapa.id, 'sup')"
        *ngIf="
          !mapa.carretera &&
          mapa.visible &&
          mapa.id >= 8 &&
          this.datoservice.mapaActual[mapa.id - 8].carretera &&
          (this.datoservice.casasDespejadas.includes(
            this.datoservice.mapaActual[mapa.id].casa
          ) ||
            (mapa.id >= 8 &&
              this.datoservice.mapaActual[mapa.id - 8].visible)) &&
          (this.datoservice.editar || mapa.puertaSup)
        "
      ></button>

      <button
        class="puertaInf"
        [ngStyle]="
          mapa.puertaInf ? { 'background-color': 'rgb(59, 22, 5)' } : {}
        "
        (click)="puerta(mapa.id, 'inf')"
        *ngIf="
          !mapa.carretera &&
          mapa.visible &&
          mapa.id <= 55 &&
          this.datoservice.mapaActual[mapa.id + 8].carretera &&
          (this.datoservice.casasDespejadas.includes(
            this.datoservice.mapaActual[mapa.id].casa
          ) ||
            (mapa.id <= 55 &&
              this.datoservice.mapaActual[mapa.id + 8].visible)) &&
          (this.datoservice.editar || mapa.puertaInf)
        "
      ></button>

      <!-- No hay nada para evitar que compruebe la primera columna al estar en la última -->
      <button
        class="puertaDer"
        [ngStyle]="
          mapa.puertaDer ? { 'background-color': 'rgb(59, 22, 5)' } : {}
        "
        (click)="puerta(mapa.id, 'der')"
        *ngIf="
          !mapa.carretera &&
          this.datoservice.mapaActual[mapa.id].visible &&
          mapa.id < 63 &&
          this.datoservice.mapaActual[mapa.id + 1].carretera &&
          (this.datoservice.casasDespejadas.includes(
            this.datoservice.mapaActual[mapa.id].casa
          ) ||
            (mapa.id < 63 &&
              this.datoservice.mapaActual[mapa.id + 1].visible)) &&
          (this.datoservice.editar || mapa.puertaDer)
        "
      ></button>
      <button
        class="puertaIzq"
        [ngStyle]="
          mapa.puertaIzq ? { 'background-color': 'rgb(59, 22, 5)' } : {}
        "
        (click)="puerta(mapa.id, 'izq')"
        *ngIf="
          !mapa.carretera &&
          mapa.visible &&
          mapa.id >= 1 &&
          this.datoservice.mapaActual[mapa.id - 1].carretera &&
          (this.datoservice.casasDespejadas.includes(
            this.datoservice.mapaActual[mapa.id].casa
          ) ||
            (mapa.id >= 1 &&
              this.datoservice.mapaActual[mapa.id - 1].visible)) &&
          (this.datoservice.editar || mapa.puertaIzq)
        "
      ></button>

      <button
        style="width: 60px; margin-top: 15px"
        (click)="alternarTipo(mapa.id)"
        *ngIf="this.datoservice.editar && !this.datoservice.editarRutas"
      >
        Alternar terreno
      </button>

      <!-- ruta de salida enemigos -->
      <span *ngIf="this.datoservice.editar" style="font-size: 8px"
        >{{ this.datoservice.mapaActual[mapa.id].rutasEnemigos }}
      </span>
      <button
        style="width: 60px; margin-top: 5px; height: 20px"
        [ngStyle]="
          this.rutaActual.includes(mapa.id)
            ? { 'background-color': 'green' }
            : {}
        "
        (click)="editarRutas('ruta', mapa.id)"
        *ngIf="this.datoservice.editar && this.datoservice.editarRutas"
      >
        Ruta
      </button>
      <!-- Enemigos -->

      <span
        *ngIf="
          this.datoservice.editar ||
          (mapa.visible &&
            (mapa.carretera ||
              (mapa.casa != '' &&
                this.datoservice.casasDespejadas.includes(mapa.casa))))
        "
        style="color: red; margin-top: -50%"
        >{{ mapa.enemigos[0] }}<br />{{ mapa.enemigos[1] }}<br />{{
          mapa.enemigos[2]
        }}{{ mapa.enemigos[3] }}{{ mapa.enemigos[4] }}</span
      >
      <span
        *ngIf="
          mapa.pista &&
          (this.datoservice.editar ||
            (mapa.casa != '' &&
              this.datoservice.casasDespejadas.includes(mapa.casa)))
        "
        style="
          color: green;
          background-color: greenyellow;
          margin-top: 50%;
          border-radius: 5px;
        "
        >Pista!</span
      >

      <div *ngIf="this.datoservice.editar" style="font-size: 10px">
        <span>cH= {{ mapa.calleH }} ... cV= {{ mapa.calleV }}</span
        ><br />
        <span>casa= {{ mapa.casa }}</span
        ><br />
        <br />
      </div>

      <span *ngIf="this.datoservice.editar">{{ mapa.id }}</span>

      <button
        class="boton"
        (click)="despejar(mapa.id)"
        *ngIf="
          !this.datoservice.editar &&
          !this.datoservice.casasDespejadas.includes(mapa.casa)
        "
        style="position: absolute"
      >
        Despejar
      </button>
      <button
        class="boton"
        (click)="buscar(mapa.casa)"
        *ngIf="
          !this.datoservice.editar &&
          this.datoservice.casasDespejadas.includes(mapa.casa)
        "
        style="
          position: absolute;
          background-color: yellow;
          box-shadow: 0px 0px 20px yellow;
        "
      >
        Buscar
      </button>
    </div>
  </div>
  <div class="menu">
    <div style="color: white; margin-top: 2vh">
      <span>Ronda número {{ this.datoservice.ronda }}</span
      ><br />
      <br />
      <button
        *ngIf="this.datoservice.editar"
        (click)="cargarAleatorio()"
        style="
          background-color: aqua;
          border: none;
          border-radius: 10px;
          box-shadow: 0px 0px 20px aqua;
        "
      >
        Empezar con <br />
        mapa aleatorio</button
      ><br />
      <br />
      <button
        *ngIf="!this.datoservice.editar"
        (click)="ronda()"
        style="
          background-color: red;
          border: none;
          border-radius: 10px;
          box-shadow: 0px 0px 20px red;
        "
      >
        Turno de los <br />
        enemigos
      </button>
      <div
        *ngIf="this.datoservice.editar == true"
        style="color: white; margin-top: 2vh"
      >
        <div style="color: white; margin-top: 2vh">
          <button *ngIf="!this.datoservice.editar" (click)="editar()">
            Editar
          </button>
          <button *ngIf="this.datoservice.editar" (click)="editar()">
            Jugar</button
          ><br /><br />
          <button
            *ngIf="this.datoservice.editar"
            (click)="editarRutas('alternar', 99)"
          >
            Crear rutas</button
          ><br />
          <button
            *ngIf="this.datoservice.editar && this.datoservice.editarRutas"
            (click)="editarRutas('aplicar', 99)"
          >
            Aplicar ruta actual</button
          ><br />
          <button
            *ngIf="
              this.datoservice.editar &&
              this.datoservice.editarRutas &&
              this.rutaActual.length > 0
            "
            (click)="editarRutas('deshacer', 99)"
          >
            Deshacer ruta actual
          </button>
          <br /><br /><br />

          <button (click)="aplicarAutomaticamente()">
            calcular visibilidad</button
          ><br /><br />
          <button (click)="generarInicio()">Generar inicio</button>
          <br /><br /><!-- 
    <br /><br /><span *ngFor="let arma of this.datoservice.recursosCasas[0]">{{arma}}<br></span>
    <br /><br /><span *ngFor="let arma of this.datoservice.recursosCasas[1]">{{arma}}<br></span>
    <br /><br />  -->

          {{ this.datoservice.armaEncontrada }}
          <br /><br /><br />

          <div>Nombre mapa: <br />{{ this.nombreMapa.value.nombre }}</div>
          <details>
            <summary>Guardar y cargar datos</summary>
            <button (click)="guardarDatos('sobrescribir')">
              Sobrescribir actual
            </button>
            <br /><br />

            <form [formGroup]="nombreMapa">
              <input
                formControlName="nombre"
                type="text"
                id="nombre"
                name="nombre"
                placeholder="Mapa"
              />
            </form>
            <button (click)="guardarDatos('nuevo')">Guardar nuevo</button
            ><br /><br />

            <li *ngIf="this.datoservice.clavesLocalStorage.length === 0">
              No hay usuarios guardados
            </li>

            <div *ngFor="let mapa of this.datoservice.clavesLocalStorage">
              <button (click)="cargarDatos(mapa)">{{ mapa }}</button>
              <button (click)="borrarDatos(mapa)">borrar</button> <br />
              <br />
            </div>
            <br />
            <button (click)="descargarJSON()">descargarJSON</button>
          </details>
        </div>
      </div>
    </div>
  </div>
</div>
